{% extends 'base.html' %}

{% load static %}

{% block title %} Viaje Fácil {% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/lista_hoteles.css' %}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
{% endblock %}

{% block content %}


<div class="container-fluid">
    <div class="row">
        <div class="col-2 ps-4 p-3">
            {% include 'filtros_hoteles.html' %}
            <!--Fin filtros-->
        </div>
        <!--Encabezado-->
        <div class="col pt-3 ps-5 ">
            <div class="row">
                <!--Lista de hoteles para ordenar-->
                <div class="col-5 pb-0">
                    <section class="ps-0 pt-0 hotel-list-section">
                        <h1>Hoteles Disponibles</h1>
                    </section>
                </div>
                <!--Fin Lista de hoteles para ordenar-->
                <!--Boton para ordenar-->
                <div class="col-2">
                    <div class="ps-0">
                        <div class="dropdown">
                            <button class="btn btn-success btn-lg  dropdown-toggle" type="button"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                Ordenar por
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">Precio: menor a mayor</a></li>
                                <li><a class="dropdown-item" href="#">Precio: mayor a menor</a></li>
                                <li><a class="dropdown-item" href="#">Más elegidos</a></li>
                                <li><a class="dropdown-item" href="#">Estrellas: menor a mayor</a></li>
                                <li><a class="dropdown-item" href="#">Estrellas: mayor a menor</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <!--Fin Boton para ordenar-->
            </div>
            <!--Card de los hoteles-->
            <div class="col-12">
                {% if hoteles %}
                {% for hotel in hoteles %}
                <div class="card mb-3" style="max-width: 1100px;">
                    <div class="row g-0">
                        <div class="col-md-3">
                            <img class="img-fluid rounded" src="{% static 'img/mardel.jpg' %}" alt="Mar del Plata">
                        </div>
                        <div class="col-md-8 ps-4">
                            <div class="card-body fs-4">
                                <h5 class="card-title fs-3 fw-bold">{{ hotel.nombre_hotel }}</h5>
                                <p class="card-text"><i class="bi bi-geo-alt-fill text-danger fs-3 pe-0"></i>
                                    {{ hotel.Direccion}}
                                    <i class="ps-5 fst-normal fw-bold">
                                        {{hotel.cantidad_estrellas_hotel}}</i>
                                        <i class="bi bi-star-fill text-warning fs-3 pe-2"></i>
                                </p>
                                        <p class="card-text fst-italic">
                                            {{hotel.descripcion_hotel}}
                                </p>
                                <p class="card-text">Impuestos nacionales incluidos</p>
                                <a href="{% url 'hotel:detalle_hotel' hotel.id %}" class="btn btn-success btn-lg">Ver
                                    detalle</a>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% else %}
            {% if error %}
            <div class="alert alert-warning fs-3">{{ error }}</div>
            {% endif %}
            {% endif %}


            <!--Fin Card de los hoteles-->

        </div>

    </div>
</div>


{% endblock %}



{% block script %}
<script>
    const DESTINOS_API_URL = "{% url 'hotel:api_destinos' %}";
</script>
<script src="{% static 'js/lista_hoteles.js' %}"></script>
<!--Verificacion de la fecha-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const hoy = new Date().toISOString().split("T")[0]; // formato YYYY-MM-DD

        const entrada = document.getElementById("fecha_entrada");
        const salida = document.getElementById("fecha_salida");

        entrada.min = hoy;
        salida.min = hoy;

        entrada.addEventListener("change", function () {
            salida.min = entrada.value;
            if (salida.value < entrada.value) {
                salida.value = entrada.value;
            }
        });
    });

    document.addEventListener("DOMContentLoaded", function () {
        const inputDestino = document.getElementById('destino');
        const sugerencias = document.getElementById('sugerencias');
        const inputTipo = document.getElementById('destino_tipo');
        const inputId = document.getElementById('destino_id');

        inputDestino.addEventListener('input', function () {
            const query = this.value;

            if (query.length < 2) {
                sugerencias.innerHTML = '';
                return;
            }

            fetch(`/hotel/ajax/buscar-destinos/?term=${encodeURIComponent(query)}`)
                .then(res => res.json())
                .then(data => {
                    sugerencias.innerHTML = '';
                    data.forEach(dest => {
                        const item = document.createElement('button');
                        item.className = 'list-group-item list-group-item-action';
                        item.textContent = dest.destino;
                        item.type = 'button';
                        item.onclick = () => {
                            inputDestino.value = dest.destino;
                            inputTipo.value = dest.tipo;
                            inputId.value = dest.id;
                            sugerencias.innerHTML = '';
                        };
                        sugerencias.appendChild(item);
                    });
                });
        });

        document.addEventListener('click', function (e) {
            if (!sugerencias.contains(e.target) && e.target !== inputDestino) {
                sugerencias.innerHTML = '';
            }
        });
    });
    document.querySelector('form').addEventListener('submit', function (e) {
    const tipo = document.getElementById('destino_tipo').value;
    const id = document.getElementById('destino_id').value;

    if (!destinoValido) {
    document.getElementById('id_direccion').value = ''; // Limpiamos el campo oculto
    }
    formulario.submit();

    });
</script>
{% endblock %}